(window.webpackJsonp=window.webpackJsonp||[]).push([[123],{1500:function(t,e,o){"use strict";var n={},r=o(4),component=Object(r.a)(n,(function(){var t=this._self._c;return t("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none","aria-hidden":"true",viewBox:"0 0 24 24",role:"img"}},[t("path",{attrs:{"vector-effect":"non-scaling-stroke",stroke:"var(--icon-color, #001e00)","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M18 3H6a3 3 0 00-3 3v8.16a3 3 0 003 3h.77V20a1 1 0 001.71.7L12 17.16h6a3 3 0 003-3V6a3 3 0 00-3-3zM7 8.08h10m-10 4h7"}})])}),[],!1,null,null,null);e.a=component.exports},1681:function(t,e,o){var content=o(2390);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,o(12).default)("02121277",content,!0,{sourceMap:!1})},1682:function(t,e,o){var content=o(2392);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,o(12).default)("e8800d74",content,!0,{sourceMap:!1,manualInject:!0})},1683:function(t,e,o){var content=o(2394);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,o(12).default)("cb02e70e",content,!0,{sourceMap:!1,manualInject:!0})},1684:function(t,e,o){var content=o(2396);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,o(12).default)("90165714",content,!0,{sourceMap:!1})},1685:function(t,e,o){var content=o(2398);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,o(12).default)("78355bec",content,!0,{sourceMap:!1})},2389:function(t,e,o){"use strict";o(1681)},2390:function(t,e,o){var n=o(11)((function(i){return i[1]}));n.push([t.i,"[data-v-4354f6eb] .air3-presence-indicator{--presence-avatar-size:30px;font-size:var(--font-size-base-xs);left:-9px;position:absolute;top:-3px}[data-v-4354f6eb] .air3-presence-indicator:after{align-items:center;color:var(--text-link-inverse);content:var(--num-unread);display:flex;justify-content:center;position:relative;width:inherit}",""]),n.locals={},t.exports=n},2391:function(t,e,o){"use strict";o(1682)},2392:function(t,e,o){var n=o(11)((function(i){return i[1]}));n.push([t.i,".width-400[data-v-22577e64]{width:400px}",""]),n.locals={},t.exports=n},2393:function(t,e,o){"use strict";o(1683)},2394:function(t,e,o){var n=o(11)((function(i){return i[1]}));n.push([t.i,".tile-body-width[data-v-54213259]{width:400px}@media (max-width:699.98px){.tile-body-width[data-v-54213259]{width:250px}}",""]),n.locals={},t.exports=n},2395:function(t,e,o){"use strict";o(1684)},2396:function(t,e,o){var n=o(11)((function(i){return i[1]}));n.push([t.i,".transition-group[data-v-eac75f50]{align-items:flex-end;bottom:35px;display:flex;flex-direction:column;position:fixed;right:15px;z-index:3}.transition-group .v-enter[data-v-eac75f50],.transition-group .v-leave-to[data-v-eac75f50]{opacity:0;transform:translateY(100%)}.transition-group .v-leave-active[data-v-eac75f50]{position:fixed}.transition-group .v-enter-active[data-v-eac75f50],.transition-group .v-leave-active[data-v-eac75f50],.transition-group .v-move[data-v-eac75f50]{transition:all 1s}.transition-group[data-v-eac75f50] .dash-notification-tile{cursor:pointer;width:auto}.transition-group[data-v-eac75f50] .dash-notification-tile:not(.keep-collapsed),.transition-group[data-v-eac75f50] .dash-notification-tile:not(.keep-collapsed) .air3-media-body{overflow:hidden;transition:all .4s}.transition-group[data-v-eac75f50] .dash-notification-tile:not(.keep-collapsed):focus,.transition-group[data-v-eac75f50] .dash-notification-tile:not(.keep-collapsed):hover{box-shadow:var(--shadow-interactive)}.transition-group[data-v-eac75f50] .dash-notification-tile.keep-collapsed,.transition-group[data-v-eac75f50] .dash-notification-tile:not(:focus):not(:hover){background:transparent;border-color:transparent}.transition-group[data-v-eac75f50] .dash-notification-tile.keep-collapsed .air3-avatar,.transition-group[data-v-eac75f50] .dash-notification-tile:not(:focus):not(:hover) .air3-avatar{box-shadow:var(--shadow-interactive)}.transition-group[data-v-eac75f50] .dash-notification-tile.keep-collapsed .air3-media-body,.transition-group[data-v-eac75f50] .dash-notification-tile:not(:focus):not(:hover) .air3-media-body{min-width:0!important;opacity:0;width:0!important}",""]),n.locals={},t.exports=n},2397:function(t,e,o){"use strict";o(1685)},2398:function(t,e,o){var n=o(11)((function(i){return i[1]}));n.push([t.i,".nav-container{background:var(--nav-bg)}",""]),n.locals={},t.exports=n},2999:function(t,e,o){"use strict";o.r(e);var n=o(1496),r=o(385),l=o(1217),d=o.n(l),c=o(1824),m=o(1489),f={components:{PresenceContainer:o(1832).a},props:{numUnread:{type:Number,default:null},userId:{type:String,required:!0}}},h=(o(2389),o(4)),v=Object(h.a)(f,(function(){var t=this;return(0,t._self._c)("PresenceContainer",{style:"--num-unread: '".concat(t.numUnread||"","';"),attrs:{"user-id":t.userId}},[t._t("default")],2)}),[],!1,null,"4354f6eb",null).exports,I=o(401),y=o(84),_={components:{UpCIcon:y.default},data:()=>({iconClose:I.default})},x={components:{CloseButton:Object(h.a)(_,(function(){var t=this._self._c;return t("button",{staticClass:"air3-btn air3-btn-link pr-0 pl-2x",attrs:{type:"button"}},[t("UpCIcon",{attrs:{icon:this.iconClose,size:"sm"}})],1)}),[],!1,null,null,null).exports,PresenceWithCount:v,RelativeTime:m.a,UpCLineClamp:r.a,UserAvatar:c.a},props:{person:{type:Object,required:!0},roomId:{type:String,required:!0}},computed:{room:t=>{let{$store:e,roomId:o}=t;return e.state.rooms.roomsByIds[o]}},injectStyles:[d.a]},w=(o(2391),{components:{ApplicantTile:Object(h.a)(x,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"dash-notification-tile p-3x air3-card air3-card-outline my-1x air3-media",attrs:{tabindex:"0"}},[e("PresenceWithCount",{staticClass:"up-media-object",attrs:{"num-unread":t.room.numUnread,"user-id":t.room.latestStory.userId}},[e("UserAvatar",{attrs:{alt:t.$t("pmgr_firstNameLastNameAvatar_417",{firstName:t.person.personalData.firstName,lastName:t.person.personalData.lastName}),size:60,src:t.person.personalData.portrait.portrait}})],1),t._v(" "),e("div",{staticClass:"air3-media-body width-400"},[e("div",{staticClass:"width-400"},[e("div",{staticClass:"d-flex"},[e("span",{staticClass:"flex-1 air3-btn-link ellipsis"},[t._v("\n          "+t._s(t.person.personalData.firstName)+"\n          "+t._s(t.person.personalData.lastName)+"\n        ")]),t._v(" "),e("RelativeTime",{staticClass:"ml-3x",attrs:{time:t.room.latestStory.created}}),t._v(" "),e("CloseButton",{nativeOn:{click:function(e){return e.stopPropagation(),t.$emit("close-click")}}})],1),t._v(" "),e("UpCLineClamp",{attrs:{expandable:!1,lines:2}},[t._v("\n        "+t._s(t.room.latestStory.message)+"\n      ")])],1)])],1)}),[],!1,null,"22577e64",null).exports},props:{application:{type:Object,required:!0},person:{type:Object,required:!0},profile:{type:Object,required:!0},roomId:{type:String,required:!0}},mounted(){this.$tracker.track({event:"impression",label:"notification_shown",sublocation:"unread_message_fab"})},methods:{openMessageModal(){this.$tracker.track({event:"click",label:"show_messages_modal",sublocation:"unread_message_fab"}),this.$openModal({data:{application:this.application},name:"modal-messages",params:this.$route.params,title:this.$t("pmgr_MessageModal.sendMessageTitle",{shortName:this.profile.shortName}),type:"modal"})}}}),C=Object(h.a)(w,(function(){var t=this;return(0,t._self._c)("ApplicantTile",{attrs:{person:t.person,"room-id":t.roomId},on:{"close-click":function(e){return t.$emit("close-click")}},nativeOn:{click:function(e){return t.openMessageModal.apply(null,arguments)}}})}),[],!1,null,null,null),P=C.exports,k=o(350),$=o(24);const j={Created:"Open",Activated:"Active",Declined:"Declined",Withdrawn:"Withdrawn",Offered:"Accepted",Replaced:"Changed",Archived:"Expired",Hired:"Hired"};var S=o(1);const N={handleApiErrors:!1,requestAlias:"clientProposalForMessages",useSubordinateOauth:!0};const U={handleApiErrors:!0,requestAlias:"freelancerProfileById",useSubordinateOauth:!0};const O={cache:!0,handleApiErrors:!0,requestAlias:"personByUid",useSubordinateOauth:!0};var M=(t,e)=>t(O).post({query:"\n  query ($personIds: [ID!]!) {\n    talentProfiles(personIds: $personIds) {\n      profiles {\n        personId\n        personalData {\n          firstName\n          lastName\n          portrait {\n            portrait\n          }\n        }\n      }\n    }\n  }\n",variables:{personIds:[e]}}).json(S.a).then((t=>{var e;let{data:data}=t;return null==data||null===(e=data.talentProfiles)||void 0===e?void 0:e.profiles[0]})),A={props:{psmManagerUid:{type:String,default:null}},data:()=>({dismissedRoomIds:[],mq:k.a.data(),notifications:[],stories:[]}),computed:{ignoredIds:t=>{let{$store:e,psmManagerUid:o}=t;return[e.state.user.id,o,null,void 0]},items:t=>{let{dismissedRoomIds:e,notifications:o,roomsByIds:n}=t;return o.map((t=>({...t,room:n[t.roomId]}))).filter((t=>!e.includes(t.roomId)&&t.room.numUnread&&t.application.applicationUid)).sort(((a,b)=>b.room.latestStory.created-a.room.latestStory.created)).slice(0,5)},roomsByIds:t=>{let{$store:e}=t;return e.state.rooms.roomsByIds}},beforeMount(){k.a.install(this)},mounted(){this.mq.desktop&&(this.fetchStories(),this.subscribeNewStory())},methods:{async fetchStories(){const t=await this.$store.dispatch("rooms/loadUserJobUnreadCountsPerApplicant");this.stories=t.filter((t=>!this.ignoredIds.includes(t.latestStory.userId))).sort(((a,b)=>b.latestStory.created-a.latestStory.created)),await this.loadNotifications(5)},async loadNotifications(t){const e=this.stories.splice(0,t);this.notifications=[...this.notifications,...await Promise.all(e.map(this.loadNotification))]},subscribeNewStory(){const t=this.$store.subscribe((async t=>{let{type:e,payload:o}=t;if("rooms/setNewStory"===e&&!this.ignoredIds.includes(o.userId)&&!this.notifications.some((t=>{let{roomId:e}=t;return e===o.roomId}))){const t=this.roomsByIds[o.roomId],e=await this.loadNotification(t);e&&(this.notifications=[...this.notifications,e])}}));this.$on("hook:destroyed",t)},async loadNotification(t){const[e,o,n]=await Promise.all([this.getApplication(t),M(this.$httpGql,t.latestStory.userId),(r=this.$httpGql,l=t.latestStory.userId,r(U).post({query:"\n  query ($profileId: ID!) {\n    freelancerProfileById(profileId: $profileId) {\n      ciphertext\n      shortName\n      name\n      recno\n      rid: recno\n      portrait {\n        portrait\n      }\n    }\n  }\n",variables:{profileId:l}}).json(S.a).then((t=>t.data.freelancerProfileById)))]);var r,l;return e.openingUid===this.$route.params.uid&&{roomId:t.roomId,application:e,person:o,profile:n}},async dismiss(t){this.dismissedRoomIds=[...this.dismissedRoomIds,t],await this.loadNotifications(1)},async getApplication(t){const e=await(o=this.$httpGql,n={id:t.jobApplicationUid},o(N).post({query:"\n  query ($id: ID!) {\n    clientProposal(id: $id) {\n      id\n      status {\n        status\n      }\n      job {\n        id\n      }\n      user {\n        id\n        name\n      }\n      room {\n        id\n      }\n    }\n  }\n",variables:n}).json(S.a));var o,n,r,l;return{applicationUid:(r=e.data.clientProposal).id,profileUid:r.user.id,dashRoomUid:null===(l=r.room)||void 0===l?void 0:l.id,openingUid:r.job.id,status:$.a[j[r.status.status]],profile:{shortName:r.user.name}}}},render(){return this.$scopedSlots.default({dismiss:this.dismiss,items:this.items})}},T=o(351),D={inject:["mq"],props:{roomId:{type:String,required:!0}},computed:{roomUrl(){return"/ab/messages/rooms/".concat(this.roomId,"/widget?noPluginActions=true&noPlugins=true&noTitle=true")},height(){return this.mq.desktop?450:350}}},L=Object(h.a)(D,(function(){var t=this;return(0,t._self._c)("iframe",{style:{border:"none",margin:"0 -24px",height:"".concat(t.height,"px"),width:"var(--popper-max-width)"},attrs:{src:t.roomUrl,title:t.$t("pmgr_Messages_19")}})}),[],!1,null,null,null).exports,z=o(1336),B={components:{LocalTime:o(1833).a,UpCIcon:y.default},props:{psmInfo:{type:Object,required:!0}},data:()=>({iconLogoUp:z.default})},R={components:{DashWidget:L,PopoverHeader:Object(h.a)(B,(function(){var t=this,e=t._self._c;return e("div",[e("div",[e("h4",{staticClass:"d-inline-block h5"},[t._v("\n      "+t._s(t.psmInfo.managerPerson.firstName)+"\n      "+t._s(t.psmInfo.managerPerson.lastName)+"\n    ")]),t._v(" "),e("UpCIcon",{staticClass:"ml-2x text-accent-on-inverse",attrs:{icon:t.iconLogoUp,size:"sm"}}),t._v(" "),e("small",{staticClass:"ml-3x"},[e("LocalTime",{attrs:{"timezone-offset":t.psmInfo.timezone.offset/60}}),t._v(" "),e("span",{domProps:{textContent:t._s(t.psmInfo.timezone.name)}})],1)],1),t._v(" "),e("small",[e("span",[t._v(t._s(t.$t("pmgr_UpworkTalentSpecialist_64")))]),t._v(" "),t.psmInfo.managerInfo.operationTimes.length?e("span",{staticClass:"ml-2x text-light",domProps:{textContent:t._s(t.$t("pmgr_AvailableWithDate_418",{date:t.psmInfo.managerInfo.operationTimes[0]}))}}):t._e()])])}),[],!1,null,null,null).exports},props:{psmInfo:{type:Object,required:!0}}},W=Object(h.a)(R,(function(){var t=this,e=t._self._c;return e("div",[e("PopoverHeader",{attrs:{"psm-info":t.psmInfo}}),t._v(" "),e("DashWidget",{attrs:{"room-id":t.psmInfo.roomId}})],1)}),[],!1,null,null,null).exports,G=o(1500),E=o(449),H=o.n(E),J={components:{UpCIcon:y.default},data:()=>({iconMessageChat:G.a}),injectStyles:[H.a]},V={components:{PresenceWithCount:v,PsmAvatar:Object(h.a)(J,(function(){var t=this._self._c;return t("div",{staticClass:"bg-accent air3-avatar air3-avatar-60"},[t("UpCIcon",{attrs:{icon:this.iconMessageChat,size:"lg"}})],1)}),[],!1,null,null,null).exports,RelativeTime:m.a,UpCLineClamp:r.a},props:{person:{type:Object,required:!0},roomId:{type:String,required:!0}},computed:{room:t=>{let{$store:e,roomId:o}=t;return e.state.rooms.roomsByIds[o]}},injectStyles:[d.a]},F=(o(2393),{components:{PsmPopover:W,PsmTile:Object(h.a)(V,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"dash-notification-tile p-3x air3-card air3-card-outline my-1x air3-media",attrs:{tabindex:"0"}},[e("PresenceWithCount",{staticClass:"up-media-object",attrs:{"num-unread":t.room.numUnread,"user-id":t.room.owner.userId}},[e("PsmAvatar")],1),t._v(" "),e("div",{staticClass:"air3-media-body tile-body-width"},[e("div",{staticClass:"tile-body-width"},[e("div",{staticClass:"d-flex"},[e("span",{staticClass:"flex-1 air3-btn-link ellipsis"},[t._v("\n          "+t._s(t.person.firstName)+"\n          "+t._s(t.person.lastName)+"\n        ")]),t._v(" "),e("RelativeTime",{staticClass:"ml-3x",attrs:{time:t.room.latestStory.created}})],1),t._v(" "),e("UpCLineClamp",{attrs:{expandable:!1,lines:2}},[t._v("\n        "+t._s(t.room.latestStory.message)+"\n      ")])],1)])],1)}),[],!1,null,"54213259",null).exports,UpCPopover:T.default},props:{sender:{type:Object,required:!0},psmInfo:{type:Object,required:!0}},data:()=>({hasOpened:!1}),mounted(){const t=this.$store.subscribeAction((t=>{"psm/togglePopover"===t.type&&this.$refs.popover.toggle()}));this.$on("hook:destroyed",t)}}),Q=Object(h.a)(F,(function(){var t=this,e=t._self._c;return e("UpCPopover",{ref:"popover",attrs:{"append-to-body":"","fallback-placements":["top"],placement:"left",size:"lg",trigger:"click","visible-arrow":!1},on:{open:function(e){t.hasOpened=!0}},scopedSlots:t._u([{key:"reference",fn:function(){return[e("PsmTile",{class:{"keep-collapsed":t.$refs.popover&&t.$refs.popover.showPopper},attrs:{person:t.sender,"room-id":t.psmInfo.roomId}})]},proxy:!0}])},[t.hasOpened?e("PsmPopover",{attrs:{"psm-info":t.psmInfo}}):t._e()],1)}),[],!1,null,null,null).exports;const Y={cache:!0,handleApiErrors:!1,useSubordinateOauth:!0,warnOnGQLErrors:!0};var K={data:()=>({persons:{},psmInfo:null}),computed:{room:t=>{let{$store:e,psmInfo:o}=t;return o&&e.state.rooms.roomsByIds[o.roomId]},sender:t=>{let{persons:e,psmInfo:o,room:n}=t;return n&&(e[n.latestStory.userId]||o.managerPerson)},userId:t=>{let{room:e}=t;return null==e?void 0:e.latestStory.userId}},watch:{userId(t){this.loadPerson(t)}},mounted(){this.loadPsmInfo()},methods:{async loadPerson(t){if(t!==this.psmInfo.managerPerson.id){const e=await M(this.$httpGql,t);this.persons={...this.persons,[t]:e.personalData}}},async loadPsmInfo(){var t,e;const o=this.$route.params.uid,n=await((t,e)=>t(Y).post({query:"\n  query proposalManagerPsm($openingId: ID!) {\n    proposalManagerPsm(openingId: $openingId) {\n      roomId\n      managerInfo {\n        operationTimes\n      }\n      managerPerson {\n        id\n        firstName\n        lastName\n      }\n      timezone {\n        name\n        offset\n      }\n    }\n  }\n",variables:{openingId:e}}).json(S.a))(this.$httpGql,o);this.psmInfo=null===(t=n.data)||void 0===t?void 0:t.proposalManagerPsm,null!==(e=this.psmInfo)&&void 0!==e&&e.roomId&&(await this.$store.dispatch("rooms/loadRoomInfo",this.psmInfo.roomId),this.loadPerson(this.room.latestStory.userId))}},render(){return this.$scopedSlots.default({sender:this.sender,psmInfo:this.psmInfo,room:this.room})}},X={components:{UpCTeleport:n.default,ApplicantNotification:P,ApplicantNotificationsLoader:A,PsmNotification:Q,PsmNotificationsLoader:K},inject:["mq"]},Z=(o(2395),o(2397),Object(h.a)(X,(function(){var t=this,e=t._self._c;return e("UpCTeleport",[e("PsmNotificationsLoader",{scopedSlots:t._u([{key:"default",fn:function(o){let{sender:n,psmInfo:r}=o;return[e("ApplicantNotificationsLoader",{key:t.mq.desktop,attrs:{"psm-manager-uid":null==r?void 0:r.managerPerson.id},scopedSlots:t._u([{key:"default",fn:function(o){let{items:l,dismiss:d}=o;return[e("TransitionGroup",{staticClass:"transition-group"},[t._l(l,(function(t){return e("ApplicantNotification",{key:t.roomId,attrs:{application:t.application,person:t.person,profile:t.profile,"room-id":t.roomId},on:{"close-click":function(e){return d(t.roomId)}},nativeOn:{click:function(e){return d(t.roomId)}}})})),t._v(" "),n?e("PsmNotification",{key:r.roomId,attrs:{"psm-info":r,sender:n}}):t._e()],2)]}}],null,!0)})]}}])})],1)}),[],!1,null,"eac75f50",null));e.default=Z.exports}}]);
//# sourceMappingURL=https://upwork-usw2-staging-assets-jsmaps.s3.us-west-2.amazonaws.com/ProposalManagerNuxt/DashNotifications-DyRgM.917464f6.js.map